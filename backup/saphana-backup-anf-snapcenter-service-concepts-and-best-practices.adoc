---
sidebar: sidebar 
permalink: backup/saphana-backup-anf-snapcenter-service-concepts-and-best-practices.html 
keywords:  
summary:  
---
= SnapCenter 서비스 개념 및 모범 사례
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:saphana-backup-anf-snapcenter-service-sap-hana-backup-solution.html["이전: SnapCenter 서비스 SAP HANA 백업 솔루션"]



== 데이터 보호 전략

SnapCenter 서비스를 구성하기 전에 다양한 SAP 시스템의 RTO 및 RPO 요구 사항에 따라 데이터 보호 전략을 정의해야 합니다.

일반적인 접근 방식은 운영, 개발, 테스트 또는 샌드박스 시스템과 같은 시스템 유형을 정의하는 것입니다. 동일한 시스템 유형의 모든 SAP 시스템은 일반적으로 동일한 데이터 보호 매개 변수를 사용합니다.

다음 매개변수를 정의해야 합니다.

* Snapshot 백업이 실행되는 빈도
* 스냅샷 백업이 유지되는 기간
* 블록 무결성 검사(파일 기반 백업)가 실행되는 빈도
* 블록 무결성 검사 백업(파일 기반 백업)은 얼마나 오래 보관됩니까?


다음 표에서는 시스템 유형의 프로덕션, 개발 및 테스트에 대한 데이터 보호 매개 변수의 예를 보여 줍니다. 운영 시스템의 경우 백업 빈도가 높고 매주 파일 기반 백업이 실행됩니다. 테스트 및 개발 시스템은 요구사항이 낮으며 Snapshot 백업은 더 자주 예약되지 않습니다.

|===
| 매개 변수 | 운영 시스템 | 개발 시스템 | 시스템을 테스트합니다 


| Snapshot 백업 빈도 | 4시간마다 | 6시간마다 | 12시간마다 


| 스냅샷 백업 보존 | 3일 | 3일 | 3일 


| 블록 무결성 검사 빈도 | 일주일에 한 번 | 일주일에 한 번 | 일주일에 한 번 


| 블록 무결성 검사 보존 | 4주 | 2주 | 1주 
|===
다음 표에는 스냅샷 백업 작업에 대한 데이터 보호 매개 변수에 대해 구성해야 하는 정책이 나와 있습니다.

|===
| 매개 변수 | 정책 스냅샷 4h | 정책 스냅샷 6h | 정책 스냅샷 12h 


| 백업 유형 | 스냅샷 복사본 기반 | 스냅샷 복사본 기반 | 스냅샷 복사본 기반 


| 일정 유형 | 매시간 | 매시간 | 매시간 


| 보존 | 개수 = 18 | 개수 = 12 | 개수 = 3 


| 백업 일정 | 4시간마다 | 6시간마다 | 12시간마다 
|===
다음 표에는 파일 기반 백업 작업에 대한 데이터 보호 매개 변수에 대해 구성해야 하는 정책이 나와 있습니다.

|===
| 매개 변수 | 정책 파일바스에네스주 | 정책 FileBased2Weeks | 정책 파일 Based1주 


| 백업 유형 | 파일 기반 | 파일 기반 | 파일 기반 


| 일정 유형 | 매주 | 매주 | 매주 


| 보존 | 개수 = 4 | 개수 = 2 | 개수 = 1 


| 백업 일정 | 매주 일요일 | 매주 일요일 | 매주 일요일 
|===


=== SnapCenter 서비스 정책

SnapCenter 서비스에서는 단일 보호 정책에 다음과 같은 매개 변수가 포함됩니다.

* 백업 유형
+
** 스냅샷 기반
** 파일 기반


* 일정 및 보존
+
** 스케줄: 시간별, 일별, 주별, 월별 하나의 정책에 여러 개의 스케줄이 있을 수 있습니다.
** 각 스케줄에 대해 시작 시간 또는 종료 시간 및 빈도가 구성됩니다.
** 각 스케줄에 대해 보존이 구성됩니다. 보존 기간은 시간 기반 또는 카운터 기반일 수 있습니다.




다음 그림에서는 정책 구성의 스크린샷을 보여 줍니다.

image:saphana-backup-anf-image10.png["오류: 그래픽 이미지가 없습니다"]



== 백업 작업

SAP는 HANA 2.0 SPS4를 사용하는 MDC 다중 테넌트 시스템에 대한 스냅샷 백업 지원을 도입했습니다. SAP HANA MDC 시스템에서 테넌트 구성이 반드시 정적이지 않을 수 있습니다. 테넌트를 추가하거나 삭제할 수 있습니다. SnapCenter 서비스는 HANA 데이터베이스를 SnapCenter에 추가할 때 검색되는 구성에 의존할 수 없습니다. SnapCenter 서비스는 백업 작업이 실행되는 시점에 사용 가능한 테넌트를 파악해야 합니다.

따라서 각 백업 작업에서 워크플로우의 첫 번째 단계는 테넌트 정보를 가져오는 것입니다. 다음 단계는 스냅샷 백업 작업 자체입니다. 이 단계에서는 HANA 백업 저장점을 트리거하는 SQL 명령, Azure NetApp Files 스냅샷 백업 및 HANA 백업 저장점을 닫기 위한 SQL 명령이 포함됩니다. close 명령을 사용하면 HANA 데이터베이스가 시스템 데이터베이스와 각 테넌트의 백업 카탈로그를 업데이트합니다.


NOTE: 하나 이상의 테넌트가 중지된 경우 SAP는 MDC 시스템에 대한 스냅샷 백업 작업을 지원하지 않습니다.

데이터 백업 및 HANA 백업 카탈로그 관리의 보존 관리를 위해 SnapCenter 서비스는 첫 번째 단계에서 식별된 시스템 데이터베이스 및 모든 테넌트 데이터베이스에 대해 카탈로그 삭제 작업을 실행해야 합니다. 로그 백업과 마찬가지로 SnapCenter 서비스 워크플로도 백업 작업의 일부인 각 테넌트에서 작동해야 합니다.

다음 그림에서는 백업 워크플로우의 개요를 보여 줍니다.

image:saphana-backup-anf-image11.jpg["오류: 그래픽 이미지가 없습니다"]



=== HANA 데이터베이스의 Snapshot 백업을 위한 백업 워크플로우

SnapCenter 서비스는 다음 순서로 SAP HANA 데이터베이스 백업을 실행합니다.

. HANA 데이터베이스에서 테넌트 목록을 읽습니다.
. 백업 작업에 대한 테넌트 정보를 SnapCenter 서비스 메타데이터에 저장합니다.
. SAP HANA 글로벌 동기화 백업 저장점을 트리거하여 지속성 계층에서 일관된 데이터베이스 이미지를 생성합니다.
+
SAP HANA MDC 단일 또는 다중 테넌트 시스템의 경우 시스템 데이터베이스와 각 테넌트 데이터베이스에 대해 동기화된 글로벌 백업 저장점이 생성됩니다.

. HANA 시스템에 구성된 모든 데이터 볼륨에 대해 Azure NetApp Files 스냅샷 복사본을 생성합니다. 단일 호스트 HANA 데이터베이스의 예로 데이터 볼륨은 하나만 있습니다. SAP HANA 다중 호스트 데이터베이스에는 여러 데이터 볼륨이 있습니다.
. Azure NetApp Files 스냅샷 백업을 SAP HANA 백업 카탈로그에 등록합니다.
. SAP HANA 백업 저장점을 삭제합니다.
. 백업을 위해 정의된 보존 정책을 기반으로 SAP HANA 백업 카탈로그뿐만 아니라 해당 데이터베이스의 Azure NetApp Files 스냅샷 복사본과 백업 항목을 삭제합니다. HANA 백업 카탈로그 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.
. SAP HANA 백업 카탈로그에 식별된 가장 오래된 데이터 백업보다 오래된 파일 시스템 및 SAP HANA 백업 카탈로그에 있는 모든 로그 백업을 삭제합니다. 이러한 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.




=== 블록 무결성 검사 작업을 위한 백업 워크플로우

SnapCenter 서비스는 다음 순서로 블록 무결성 검사를 실행합니다.

. HANA 데이터베이스에서 테넌트 목록을 읽습니다.
. 시스템 데이터베이스 및 각 테넌트에 대해 파일 기반 백업 작업을 트리거합니다.
. 블록 무결성 검사 작업에 정의된 보존 정책을 기반으로 데이터베이스, 파일 시스템 및 SAP HANA 백업 카탈로그에서 파일 기반 백업을 삭제합니다. 파일 시스템에서 백업 삭제 및 HANA 백업 카탈로그 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.
. SAP HANA 백업 카탈로그에 식별된 가장 오래된 데이터 백업보다 오래된 파일 시스템 및 SAP HANA 백업 카탈로그에 있는 모든 로그 백업을 삭제합니다. 이러한 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.




== 백업 보존 관리 및 데이터 및 로그 백업 관리

데이터 백업 보존 관리 및 로그 백업 정리정돈은 다음 보존 관리를 포함하여 4가지 주요 영역으로 나눌 수 있습니다.

* Snapshot 백업
* 파일 기반 백업
* SAP HANA 백업 카탈로그 내의 데이터 백업
* SAP HANA 백업 카탈로그 및 파일 시스템에 로그 백업


다음 그림에서는 다양한 워크플로우와 각 작업의 종속 관계를 간략하게 보여 줍니다. 다음 섹션에서는 다양한 작업에 대해 자세히 설명합니다.

image:saphana-backup-anf-image12.png["오류: 그래픽 이미지가 없습니다"]



=== Snapshot 백업의 보존 관리

SnapCenter 서비스는 SnapCenter 서비스 백업 정책에 정의된 보존에 따라 스토리지 및 SnapCenter 서비스 저장소에서 스냅샷 복사본을 삭제하여 SAP HANA 데이터베이스 백업 및 비 데이터 볼륨 백업의 내부 관리를 처리합니다.

보존 관리 로직은 SnapCenter의 각 백업 워크플로우에서 실행됩니다.

SnapCenter에서 수동으로 스냅샷 백업을 삭제할 수도 있습니다.



=== 파일 기반 백업의 보존 관리

SnapCenter 서비스는 SnapCenter 서비스 백업 정책에 정의된 보존에 따라 파일 시스템에서 백업을 삭제하여 파일 기반 백업의 관리 작업을 처리합니다.

보존 관리 로직은 SnapCenter의 각 백업 워크플로우에서 실행됩니다.



=== SAP HANA 백업 카탈로그 내에서 데이터 백업의 보존 관리

SnapCenter 서비스에서 백업(스냅샷 또는 파일 기반)을 삭제하면 SAP HANA 백업 카탈로그에서도 이 데이터 백업도 삭제됩니다.



=== 로그 백업의 보존 관리

SAP HANA 데이터베이스는 로그 백업을 자동으로 생성합니다. 이러한 로그 백업을 실행하면 SAP HANA에 구성된 백업 디렉토리에 있는 각 개별 SAP HANA 서비스에 대한 백업 파일이 생성됩니다.

최신 데이터 백업보다 오래된 로그 백업은 더 이상 전달 복구에 필요하지 않으며 삭제할 수 있습니다.

SnapCenter 서비스는 다음 작업을 실행하여 파일 시스템 레벨뿐만 아니라 SAP HANA 백업 카탈로그에 있는 로그 파일 백업의 하우스키핑을 처리합니다.

. SAP HANA 백업 카탈로그를 읽어 가장 오래된 파일 기반 또는 스냅샷 백업의 백업 ID를 가져옵니다.
. SAP HANA 카탈로그에 있는 모든 로그 백업과 이 백업 ID보다 오래된 파일 시스템을 삭제합니다.
+
SnapCenter 서비스는 SnapCenter에서 생성한 백업의 하우스키핑 작업만 처리합니다. SnapCenter 외부에서 추가 파일 기반 백업이 생성되는 경우 파일 기반 백업이 백업 카탈로그에서 삭제되었는지 확인해야 합니다. 이러한 데이터 백업이 백업 카탈로그에서 수동으로 삭제되지 않으면 가장 오래된 데이터 백업이 될 수 있으며, 이 파일 기반 백업이 삭제될 때까지 오래된 로그 백업이 삭제되지 않습니다.




NOTE: SnapCenter 서비스의 현재 릴리즈에서는 로그 백업 보존 관리를 끌 수 없습니다.



== Snapshot 백업의 용량 요구 사항

기존 데이터베이스의 변경률에 비해 스토리지 계층의 블록 변경률이 더 높아야 합니다. 열 저장소의 HANA 테이블 병합 프로세스로 인해 전체 테이블이 변경된 블록만 아니라 디스크에 기록됩니다. 하루 동안 여러 스냅샷 백업을 수행한 경우 고객 기반의 데이터에 의하면 20%에서 50% 사이의 일일 변경률이 표시됩니다.

link:saphana-backup-anf-lab-setup-used-for-this-report.html["다음: 이 보고서에 사용된 랩 설정."]

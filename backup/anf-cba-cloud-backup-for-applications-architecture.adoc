---
sidebar: sidebar 
permalink: backup/anf-cba-cloud-backup-for-applications-architecture.html 
keywords: applications, anf, strategy, data protection, backup 
summary: Cloud Backup for Applications는 NetApp 클라우드 스토리지에서 실행되는 애플리케이션에 데이터 보호 기능을 제공하는 SaaS 솔루션입니다. NetApp BlueXP에서 지원되는 애플리케이션을 위한 클라우드 백업은 애플리케이션 정합성을 보장하고 Azure NetApp Files 기반 SAP HANA를 정책 기반으로 효율적으로 보호합니다. Cloud Backup for Applications는 중앙 집중식 제어 및 감독을 제공하는 동시에, 사용자가 애플리케이션별 백업 및 복원 작업을 관리하는 기능을 위임합니다. 
---
= Cloud Backup for Applications 아키텍처
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-use-cases-and-value-of-accelerated-backup-and-cloning-operations_overview.html["이전: Cloud Backup for Applications 아키텍처 개요"]

[role="lead"]
Cloud Backup for Applications는 NetApp 클라우드 스토리지에서 실행되는 애플리케이션에 데이터 보호 기능을 제공하는 SaaS 솔루션입니다. NetApp BlueXP에서 지원되는 애플리케이션을 위한 클라우드 백업은 애플리케이션 정합성을 보장하고 Azure NetApp Files 기반 SAP HANA를 정책 기반으로 효율적으로 보호합니다. Cloud Backup for Applications는 중앙 집중식 제어 및 감독을 제공하는 동시에, 사용자가 애플리케이션별 백업 및 복원 작업을 관리하는 기능을 위임합니다.

Cloud Backup for Applications는 NetApp BlueXP에서 SaaS로 실행되며 프레임워크 및 UI를 활용합니다. BlueXP 작업 환경 프레임워크는 Azure NetApp Files의 자격 증명을 구성하고 관리하는 데 사용됩니다.

BlueXP 커넥터는 고객 VNET 내에 배포해야 합니다. NetApp SaaS 구성 요소와 고객 환경 간의 통신은 커넥터를 통해서만 수행됩니다. 이 커넥터는 ANF 관리 API를 사용하여 ANF 스토리지 작업을 실행합니다.

HANA 플러그인은 HANA 데이터베이스별 논리를 제공하며 각 HANA 호스트에 구축해야 합니다. HANA 플러그인은 HANA hdbsql 클라이언트와 사용자 저장소 키를 사용하여 HANA 데이터베이스와 통신합니다. 모든 데이터베이스 작업은 BlueXP 커넥터에 의해 트리거됩니다.

image:anf-cba-image5.png["이 이미지는 고객 네트워크 및 Azure 서브스크립션과 함께 NetApp SaaS의 기본 아키텍처를 보여줍니다."]



== ANF 기반 SAP HANA용 Cloud Backup for Applications



=== 솔루션 개요

Cloud Backup for Application은 다음 구성 요소에 대해 스냅샷 기반 백업 작업을 지원합니다.

. * SAP HANA 시스템 * 데이터 볼륨.
. SAP HANA 데이터베이스의 * 비 데이터 볼륨 예를 들면, 입니다 `/hana/shared` 볼륨 및/또는 SAP 애플리케이션 서버 데이터
. * 특정 HANA 시스템에 속하지 않는 글로벌 비 데이터 볼륨 *. 예를 들어, SAP 전송 디렉토리입니다 `/usr/sap/trans`.


이러한 구성 요소의 백업 작업은 다음과 같습니다.

* 예약된 백업 또는 필요 시 백업
* 사전/사후 스크립트 옵션
* 정책 기반 보존 관리
+
** ANF 볼륨 레벨의 스냅샷
** SAP HANA 백업 카탈로그 내(HANA 데이터 볼륨 백업용)




SAP HANA 파일 기반 백업은 데이터베이스 블록 무결성 검사에 사용되며, 필요 시 또는 예약된 백업 작업으로 실행될 수도 있습니다. 정책 기반 보존 관리는 파일 시스템 레벨 및 HANA 백업 카탈로그 내에서 수행됩니다.

HANA 데이터베이스 로그 백업의 보존 관리는 HANA 데이터베이스 데이터 백업(스냅샷 또는 파일 기반)의 정의된 보존을 기반으로 수행됩니다.

CBA는 모든 스냅샷 기반 백업에 대한 복원 작업을 지원합니다. 파일 기반 백업은 기본 HANA 툴을 사용해서만 복원할 수 있습니다.

image:anf-cba-image6.png["이 이미지는 HANA 시스템 멀티 테넌트 데이터베이스 컨테이너 및 글로벌 비 데이터 볼륨에 대한 백업 및 복원을 보여 줍니다."]



=== 솔루션 운영

스냅샷 데이터 백업은 SAP HANA 데이터베이스 백업 저장점을 트리거하여 Cloud Backup for Applications에서 실행되므로 스토리지 계층에 생성된 스냅샷 복사본은 SAP HANA 데이터베이스의 일관된 이미지를 기반으로 합니다. 를 참조하십시오 https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/b41a2823576f4726be649bc98e61d62c.html?q=sap%20hana%20snapshot%20backup["SAP 관리 가이드 를 참조하십시오"^] 를 참조하십시오.

Cloud Backup for Applications는 모든 SAP HANA 관련 리소스를 완벽하게 백업할 수 있도록 스토리지 기반 Snapshot 복사본을 사용하여 데이터가 아닌 모든 볼륨을 백업할 수도 있습니다. 개별 보존 및 보호 정책을 사용할 수 있도록 데이터베이스 데이터 백업과 별도로 비데이터 볼륨을 예약할 수 있습니다.

SAP는 블록 무결성 검사를 실행하기 위해 스토리지 기반 스냅샷 백업을 주간 파일 기반 백업과 결합할 것을 권장합니다. CBA 내에서 블록 무결성 검사를 실행할 수 있습니다. 블록 무결성 검사(파일 기반) 백업도 백업을 보조 스토리지 위치로 오프로드하는 데 사용됩니다.

구성 가능한 보존 정책을 기반으로 Cloud Backup for Applications는 데이터 백업, 로그 백업, SAP HANA 백업 카탈로그를 관리하는 기능을 제공합니다.

다음 그림에서는 백업 솔루션을 요약합니다.

image:anf-cba-image7.png["이 그림은 백업 솔루션을 요약합니다."]

비데이터 볼륨의 스토리지 기반 스냅샷 백업을 실행할 때 Cloud Backup for Applications는 다음 작업을 수행합니다.

. 비 데이터 볼륨의 스토리지 스냅샷 복사본을 생성합니다.
. 정의된 보존 정책을 기반으로 스토리지 스냅샷 복사본을 삭제합니다.


SAP HANA 데이터베이스의 스토리지 기반 스냅샷 백업을 실행할 때 Cloud Backup for Applications는 다음 작업을 수행합니다.

. SAP HANA 백업 저장점을 생성하여 지속성 계층에서 일관된 이미지를 생성합니다.
. 데이터 볼륨의 스토리지 스냅샷 복사본을 생성합니다.
. 스토리지 스냅샷 백업을 SAP HANA 백업 카탈로그에 등록합니다.
. SAP HANA 백업 저장점을 릴리즈합니다.
. 정의된 보존 정책을 기반으로 스토리지 스냅샷 복사본을 삭제합니다.
. 정의된 보존 정책을 기반으로 SAP HANA 백업 카탈로그 항목을 삭제합니다.
. 데이터 백업을 수동으로 삭제하거나 보존 정책을 기반으로 할 때마다 Cloud Backup for Applications는 가장 오래된 데이터 백업보다 오래된 모든 로그 백업을 삭제합니다. 로그 백업은 파일 시스템과 SAP HANA 백업 카탈로그에서 삭제됩니다.




=== 지원되는 SAP HANA 릴리즈 및 구성

Cloud Backup for Applications는 다음과 같은 구성 옵션을 사용하는 하나 또는 여러 테넌트가 있는 HANA MDC 시스템을 지원합니다.

* SAP HANA 2.0 SPS4 이상
* SAP HANA 단일 호스트 시스템
* 섹션에 설명된 대로 SAP HANA 다중 호스트 시스템을 구축할 수 있습니다 link:anf-cba-backup-operations-with-hana-system-replication.html#backup-operations-with-hana-multiple-host-systems[""HANA 다중 호스트 시스템을 사용한 백업 작업""]
* 섹션에 설명된 대로 HSR(HANA 시스템 복제)으로 구성된 SAP HANA 시스템 link:anf-cba-backup-operations-with-hana-system-replication.html["“HANA 시스템 복제를 사용한 백업 작업”"]




== Cloud Backup for Applications 개념 및 모범 사례



=== 데이터 보호 전략

Cloud Backup for Applications를 구성하기 전에 다양한 SAP 시스템의 RTO 및 RPO 요구 사항에 따라 데이터 보호 전략을 정의해야 합니다.

일반적인 접근 방식은 운영, 개발, 테스트 또는 샌드박스 시스템과 같은 시스템 유형을 정의하는 것입니다. 동일한 시스템 유형의 모든 SAP 시스템은 일반적으로 동일한 데이터 보호 매개 변수를 사용합니다.

다음 매개변수를 정의해야 합니다.

* Snapshot 백업이 실행되는 빈도
* 스냅샷 백업이 유지되는 기간
* 블록 무결성 검사(파일 기반 백업)가 실행되는 빈도
* 블록 무결성 검사 백업(파일 기반 백업)이 유지되는 기간


다음 표에서는 시스템 유형의 운영, 개발 및 테스트에 대한 데이터 보호 매개 변수의 예를 보여 줍니다. 운영 시스템의 경우 백업 빈도가 높고 매주 파일 기반 백업이 실행됩니다. 테스트 및 개발 시스템은 요구사항이 낮으며 Snapshot 백업은 더 자주 예약되지 않습니다.

|===
| 매개 변수 | 운영 시스템 | 개발 시스템 | 시스템을 테스트합니다 


| Snapshot 백업 빈도 | 4시간마다 | 6시간마다 | 12시간마다 


| 스냅샷 백업 보존 | 3일 | 3일 | 3일 


| 블록 무결성 검사 빈도 | 일주일에 한 번 | 일주일에 한 번 | 일주일에 한 번 


| 블록 무결성 검사 보존 | 4주 | 2주 | 1주 
|===
다음 표에는 스냅샷 백업 작업에 대한 데이터 보호 매개 변수에 대해 구성해야 하는 정책이 나와 있습니다.

|===
| 매개 변수 | 정책 스냅샷 4h | 정책 스냅샷 6h | 정책 스냅샷 12h 


| 백업 유형 | 스냅샷 기반 | 스냅샷 기반 | 스냅샷 기반 


| 일정 유형 | 매시간 | 매시간 | 매시간 


| 보존 | 개수 = 18 | 개수 = 12 | 개수 = 3 


| 백업 일정 | 4시간마다 | 6시간마다 | 12시간마다 
|===
다음 표에는 파일 기반 백업 작업에 대한 데이터 보호 매개 변수에 대해 구성해야 하는 정책이 나와 있습니다.

|===
| 매개 변수 | 정책 파일바스에네스주 | 정책 FileBased2Weeks | 정책 파일 Based1주 


| 백업 유형 | 파일 기반 | 파일 기반 | 파일 기반 


| 일정 유형 | 매주 | 매주 | 매주 


| 보존 | 개수 = 4 | 개수 = 2 | 개수 = 1 


| 백업 일정 | 매주 일요일 | 매주 일요일 | 매주 일요일 
|===


== 백업 작업

SAP는 HANA 2.0 SPS4를 사용하는 MDC 다중 테넌트 시스템에서 스냅샷 백업에 대한 지원을 도입했습니다. SAP HANA MDC 시스템에서 테넌트 구성이 반드시 정적이지 않을 수 있습니다. 테넌트를 추가하거나 삭제할 수 있습니다. Cloud Backup for Applications는 HANA 데이터베이스를 Cloud Backup for Applications에 추가할 때 검색된 구성을 사용할 수 없습니다. Cloud Backup for Applications는 백업 작업이 실행되는 시점에 사용 가능한 테넌트를 파악해야 합니다.

따라서 각 백업 작업에서 워크플로우의 첫 번째 단계는 테넌트 정보를 가져오는 것입니다. 다음 단계는 스냅샷 백업 작업 자체입니다. 이 단계에서는 HANA 백업 저장점, ANF 스냅샷 백업 및 HANA 백업 저장점을 닫기 위한 SQL 명령을 트리거하는 SQL 명령이 포함됩니다. close 명령을 사용하면 HANA 데이터베이스가 시스템 데이터베이스와 각 테넌트의 백업 카탈로그를 업데이트합니다.


NOTE: 하나 이상의 테넌트가 중지된 경우 SAP HANA는 MDC 시스템에 대한 스냅샷 백업 작업을 지원하지 않습니다.

데이터 백업 및 HANA 백업 카탈로그 관리의 보존 관리를 위해 Cloud Backup for Applications는 첫 번째 단계에서 식별된 시스템 데이터베이스 및 모든 테넌트 데이터베이스에 대해 카탈로그 삭제 작업을 실행해야 합니다. 로그 백업과 마찬가지로 Cloud Backup for Applications 워크플로는 백업 작업의 일부인 각 테넌트에서 작동해야 합니다.

다음 그림에서는 백업 워크플로우의 개요를 보여 줍니다.

image:anf-cba-image8.png["이 그림에서는 백업 워크플로우의 개요를 보여 줍니다."]



=== HANA 데이터베이스의 Snapshot 백업을 위한 백업 워크플로우

Cloud Backup for Applications는 SAP HANA 데이터베이스를 다음 순서로 백업합니다.

. Cloud Backup for Applications는 HANA 데이터베이스에서 테넌트 목록을 읽습니다.
. 테넌트 정보는 백업 작업을 위한 Cloud Backup for Applications 메타데이터에 저장됩니다.
. Cloud Backup for Applications는 SAP HANA 글로벌 동기화 백업 저장점을 트리거하여 지속성 계층에서 일관된 데이터베이스 이미지를 생성합니다.
+

NOTE: SAP HANA MDC 단일 또는 다중 테넌트 시스템의 경우 시스템 데이터베이스와 각 테넌트 데이터베이스에 대해 동기화된 글로벌 백업 저장점이 단일 작업으로 생성됩니다.

. Cloud Backup for Applications는 HANA 시스템에 구성된 모든 데이터 볼륨에 대해 ANF 스냅샷 복사본을 생성합니다. 단일 호스트 HANA 데이터베이스의 경우 데이터 볼륨은 하나만 있습니다. SAP HANA 다중 호스트 데이터베이스에는 여러 데이터 볼륨이 있습니다.
. Cloud Backup for Applications는 SAP HANA 백업 카탈로그에 스냅샷 백업을 등록합니다.
. Cloud Backup for Applications는 SAP HANA 백업 저장점을 삭제합니다.
. Cloud Backup for Applications는 백업에 정의된 보존 정책을 기반으로 ANF 스냅샷 복사본과 데이터베이스의 백업 항목을 삭제합니다. HANA 백업 카탈로그 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.
. Cloud Backup for Applications는 SAP HANA 백업 카탈로그에서 식별된 가장 오래된 성공적인 데이터 백업보다 오래된 파일 시스템 및 SAP HANA 백업 카탈로그에서 모든 로그 백업을 삭제합니다. 이러한 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.




=== 블록 무결성 검사 작업을 위한 백업 워크플로우

Cloud Backup for Applications는 다음 순서대로 블록 무결성 검사를 실행합니다.

. Cloud Backup for Applications는 HANA 데이터베이스에서 테넌트 목록을 읽습니다.
. Cloud Backup for Applications는 시스템 데이터베이스와 각 테넌트에 대해 파일 기반 백업 작업을 트리거합니다.
. Cloud Backup for Applications는 블록 무결성 검사 작업에 정의된 보존 정책을 기반으로 데이터베이스, 파일 시스템 및 SAP HANA 백업 카탈로그에서 파일 기반 백업을 삭제합니다. 파일 시스템에서 백업 삭제 및 HANA 백업 카탈로그 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.
. Cloud Backup for Applications는 SAP HANA 백업 카탈로그에 식별된 가장 오래된 데이터 백업보다 오래된 파일 시스템 및 SAP HANA 백업 카탈로그의 모든 로그 백업을 삭제합니다. 이러한 작업은 시스템 데이터베이스 및 모든 테넌트에 대해 수행됩니다.




== 백업 보존 관리 및 데이터 및 로그 백업 관리

데이터 백업 보존 관리 및 로그 백업 정리정돈은 다음 보존 관리를 포함하여 네 가지 주요 영역으로 나눌 수 있습니다.

* Snapshot 백업
* 파일 기반 백업
* SAP HANA 백업 카탈로그 내의 데이터 백업
* SAP HANA 백업 카탈로그 및 파일 시스템에 로그 백업


다음 그림에서는 다양한 워크플로우와 각 작업의 종속 관계를 간략하게 보여 줍니다. 다음 섹션에서는 다양한 작업에 대해 자세히 설명합니다.

image:anf-cba-image9.png["이 그림에서는 다양한 워크플로우와 각 작업의 종속 관계를 간략하게 보여 줍니다."]



=== Snapshot 백업의 보존 관리

Cloud Backup for Applications는 Cloud Backup for Applications 백업 정책에 정의된 보존에 따라 스토리지 및 Cloud Backup for Applications 저장소에 있는 스냅샷 복사본을 삭제하여 SAP HANA 데이터베이스 백업 및 비 데이터 볼륨 백업의 내부 관리를 처리합니다.

보존 관리 로직은 Cloud Backup for Applications의 각 백업 워크플로우에서 실행됩니다.

Cloud Backup for Applications에서 Snapshot 백업을 수동으로 삭제할 수도 있습니다.



=== 파일 기반 백업의 보존 관리

Cloud Backup for Applications는 Cloud Backup for Applications 백업 정책에 정의된 보존에 따라 파일 시스템에서 백업을 삭제하여 파일 기반 백업의 관리 작업을 처리합니다.

보존 관리 로직은 Cloud Backup for Applications의 각 백업 워크플로우에서 실행됩니다.



=== SAP HANA 백업 카탈로그 내에서 데이터 백업의 보존 관리

Cloud Backup for Applications가 백업(스냅샷 또는 파일 기반)을 삭제할 경우 이 데이터 백업도 SAP HANA 백업 카탈로그에서 삭제됩니다.



=== 로그 백업의 보존 관리

SAP HANA 데이터베이스는 로그 백업을 자동으로 생성합니다. 이러한 로그 백업을 실행하면 SAP HANA에 구성된 백업 디렉토리에 있는 각 개별 SAP HANA 서비스에 대한 백업 파일이 생성됩니다.

가장 오래된 성공적인 데이터 백업보다 오래된 로그 백업은 더 이상 전달 복구에 필요하지 않으므로 삭제할 수 있습니다.

Cloud Backup for Applications는 다음 단계를 수행하여 파일 시스템 레벨뿐만 아니라 SAP HANA 백업 카탈로그에서 로그 파일 백업의 관리 작업을 처리합니다.

* Cloud Backup for Applications는 SAP HANA 백업 카탈로그를 읽어 가장 오래된 파일 기반 또는 스냅샷 백업의 백업 ID를 가져옵니다.
* Cloud Backup for Applications는 SAP HANA 카탈로그 및 이 백업 ID보다 오래된 파일 시스템의 모든 로그 백업을 삭제합니다.



NOTE: Cloud Backup for Applications는 Cloud Backup for Applications에서 생성된 백업의 하우스키핑만 처리합니다. Cloud Backup for Applications 외부에서 추가 데이터 백업을 생성하는 경우 데이터 백업이 백업 카탈로그에서 삭제되었는지 확인해야 합니다. 이러한 데이터 백업이 백업 카탈로그에서 수동으로 삭제되지 않으면 가장 오래된 데이터 백업이 될 수 있으며, 이 데이터 백업이 삭제될 때까지 오래된 로그 백업이 삭제되지 않습니다.


NOTE: 로그 백업 관리 기능은 기본적으로 활성화되어 있지만 HANA 플러그인 호스트 레벨에서 비활성화할 수 있습니다. 를 편집합니다 `hana.property` 파일 `/opt/NetApp/snapcenter/scc/etc`. 매개 변수를 포함합니다 `LOG_CLEANUP_DISABLE = Y` 에 있습니다 `hana.property` 구성 파일은 로그 백업 관리 기능을 비활성화합니다. 파일이 없으면 만들어야 합니다.



== HANA 데이터베이스에 대한 보안 통신 지원

HANA 데이터베이스가 보안 통신으로 구성된 경우 를 참조하십시오 `hdbsql` CBA에 의해 실행되는 명령에서는 추가적인 명령줄 옵션을 사용해야 합니다. 이 작업은 를 호출하는 래퍼 스크립트를 사용하여 수행할 수 있습니다 `hdbsql` 을 선택합니다.


NOTE: SSL 통신을 구성하기 위한 다양한 옵션이 있습니다. 다음 예제에서 가장 간단한 클라이언트 구성은 명령줄 옵션을 사용하여 설명합니다. 이 경우 서버 인증서 유효성 검사가 수행되지 않습니다. 서버 및/또는 클라이언트 측에서 인증서 검증이 필요한 경우 다른 hdbsql 명령줄 옵션이 필요하며, SAP HANA 보안 가이드 에 설명된 대로 PSE 환경을 구성해야 합니다.

를 구성하는 대신 `hdbsql` 의 실행 파일 `hana.properties` 파일 래퍼 스크립트를 추가합니다. 파일을 엽니다 `/opt/NetApp/snapcenter/scc/etc/hana.properties`다음 콘텐츠를 추가해야 합니다. 파일이 없으면 만들어야 합니다.

이 예는 SID = SM1 및 인스턴스 번호 = 12가 있는 HANA 시스템에 대한 것입니다.

....
HANA_HDBSQL_CMD = /usr/sap/SM1/HDB12/exe/hdbsqls
....
래퍼 스크립트 hdbsqls는 필요한 명령줄 옵션으로 hdbsql을 호출합니다.

....
#/bin/bash
/usr/sap/SM1/HDB12/exe/hdbsql -e -ssltrustcert $*
....


== Snapshot 백업의 용량 요구 사항

기존 데이터베이스의 변경률에 비해 스토리지 계층의 블록 변경률이 더 높아야 합니다. 열 저장소의 HANA 테이블 병합 프로세스로 인해 테이블의 변경된 데이터뿐만 아니라 전체 테이블이 디스크에 기록됩니다.

하루 동안 여러 스냅샷 백업을 수행한 경우 고객 기반의 데이터에 따르면 매일 변경률이 20%~50% 사이인 것으로 나타났습니다.

link:anf-cba-overview-of-installation-and-configuration-steps.html["다음: 설치 및 구성 단계 개요"]
